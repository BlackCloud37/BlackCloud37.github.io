<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
        <meta content="text/html; charset=UTF-8" http-equiv="content-type"/>
        <meta content="width=device-width, initial-scale=1" name="viewport"/>

        
        
        

        
        
        

        
        
        

        
        
        

        
        
        

        <title>Wechat</title>
        
        <meta name="title" content="Wechat">
        <meta name="author" content="Chen Ye">
        <meta name="description" content="Somewhere">
        <meta name="generator" content="Zola v0.16.1">

        <meta property="og:type" content="website">
        <meta property="og:url" content="https://yechenz37.tech/misc/arch/wechat/">
        <meta property="og:site_name" content="Pissf****t&#x27;s">
        <meta property="og:title" content="Wechat">
        <meta property="og:description" content="Somewhere">
        <meta property="og:image" content="https:&#x2F;&#x2F;yechenz37.tech&#x2F;images&#x2F;logo.png">

        
        
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="https://yechenz37.tech/misc/arch/wechat/">
        <meta property="twitter:title" content="Wechat">
        <meta property="twitter:description" content="Somewhere">
        <meta property="twitter:image" content="https:&#x2F;&#x2F;yechenz37.tech&#x2F;images&#x2F;logo.png">
        
        
        <link rel="canonical" href="https://yechenz37.tech/misc/arch/wechat/">
        <link rel="shortcut icon" type="image/x-icon" href="https://yechenz37.tech/images/logo.png">
        <script type="application/ld+json">
            {
                "description":"Somewhere",
                "url":"https://yechenz37.tech/misc/arch/wechat/",
                "@type":"WebSite",
                "headline":"Wechat",
                "name":"Wechat",
                "author":{
                    "@type":"Person",
                    "name":"Chen Ye"
                },
                "@context":"https://schema.org"
            }
        </script>
        
        
        
        <link rel="alternate" type="application/atom+xml" title="RSS" href="https://yechenz37.tech/atom.xml">
        
        
        
        <link rel="stylesheet" href="https://yechenz37.tech/style.css"/>
        
    </head>
    <body theme="auto">
        <div class="w">
            <header>
                
                <nav>
                    
                    <a href="/" >~home</a>
                    
                    <a href="/tags" >#tags</a>
                    
                    <a href="/categories" >+categories</a>
                    
                </nav>
                
                
<p><a href="..">..</a>/wechat</p>
<p class="post-meta"><time datetime="2024-09-05">2024-09-05</time></p>
<h1>Wechat</h1>

            </header>
            <main class="page-content" aria-label="Content">
                



<h2 id="20240905-geng-xin">20240905 更新</h2>
<p>上周某次系统滚动更新后，原先的 v3.8.0.33 由于是 x86 版本，会报 dll 错误，参考了网上的资料均未解决，而切到 x64 版本又有一些小 bug</p>
<p>看到 <a href="https://wiki.archlinuxcn.org/wiki/%E5%BE%AE%E4%BF%A1#%E5%BE%AE%E4%BF%A1_Linux_%E5%8E%9F%E7%94%9F%E7%89%88%E9%87%8D%E6%9E%84">wiki</a> 更新了重构版的 wechat-uos</p>
<p>发现体验还可以，没有各种字体 bug，唯一的缺点是不能撤回和引用</p>
<h2 id="20240125geng-xin">20240125更新</h2>
<p>备忘目前完整的微信安装流程</p>
<ol>
<li>装 wine-for-wechat 和 wine-wechat-setup</li>
<li><a href="https://github.com/tom-snow/wechat-windows-versions">https://github.com/tom-snow/wechat-windows-versions</a> 找老版本的微信安装包, 例如 Wechat v3.8.0.33
<blockquote>
<p>wine-for-wechat 会默认使用 prefix / 'drive_c/Program Files/Tencent/WeChat' 作为 WeChat.exe 的目录, 安装微信时需要注意, 旧版本微信可能会默认安装到 Program Files x86 下</p>
</blockquote>
</li>
<li>用 wine-wechat-setup 安装微信, 会一并创建 ~/.local/lib/wine-wechat 这个 WINEPREFIX</li>
</ol>
<ul>
<li>此时安装程序的字体可能为方块, 建议在创建完 WINPREFIX 之后即在字体目录下放置必要的字体, 参考 <a href="https://blog.gloriousdays.pw/2018/12/01/optimize-wine-font-rendering">https://blog.gloriousdays.pw/2018/12/01/optimize-wine-font-rendering</a></li>
<li>字体问题解决后方可设置微信安装目录</li>
</ul>
<p>如果需要改 dpi 等, 可以 <code>wechat -c</code></p>
<h2 id="archive">Archive</h2>
<p>更新: 现在使用 com.qq.weixin.spark 包的微信，然后将其用的 wine 替换成 wine-for-wechat</p>
<p>使用打包好的 <a href="https://github.com/vufa/deepin-wine-wechat-arch">Deepin Wine Wechat Arch</a>，仓库中已经给出了详细的安装方法、字体更换等</p>
<h3 id="sway">Sway</h3>
<p>从 i3 迁移到 sway 后, Deepin Wine Wechat 的微信窗口黑屏, 暂时没找到解决办法, 改用 wine-for-wechat 后解决</p>
<p>安装流程</p>
<ol>
<li>安装 wine-for-wechat, wine-wechat 包, 均在 archlinuxcn 源上</li>
<li>微信官网下载 <code>.exe</code> 安装包</li>
<li>命令行 <code>wechat -i /path/to/wechat_setup.exe</code> 安装微信</li>
<li>安装完成后就能使用, 如果字体有问题, 参考 <a href="https://gist.github.com/qin-yu/bfd799f2380c875045e7c8b918d02f36">Ubuntu20.04 Wine 6.0 微信中文显示方块/方框</a>, 本质上为如下几步</li>
</ol>
<ul>
<li>winetricks 安装所有字体和所需 dll</li>
<li>改注册表</li>
</ul>
<p>不过仍然没解决 emoji 为方块的问题</p>
<h3 id="trouble-shotting">Trouble shotting</h3>
<h4 id="chuang-kou-yin-ying">窗口阴影</h4>
<p>换到 i3wm 后，混成器使用了 picom，此时使用 Deepin Wine Wechat 会发现整个窗口被灰色遮罩，且有弧形的黑色阴影，关闭 picom 后上述情况消失，因此判断是 picom 的问题</p>
<p>查阅 arch wiki 上 picom 条目发现，picom 可以针对窗口禁用半透明、阴影等特性，其规则可以细化到匹配窗口名称</p>
<p>首先通过 <code>xprop</code> 查询微信的窗口名:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span># xprop
</span><span>WM_NAME(STRING) = &quot;WeChat&quot;
</span><span>...
</span><span>WM_CLASS(STRING) = &quot;wechat.exe&quot;, &quot;Wine&quot;
</span></code></pre>
<p>然后在 <code>picom.conf</code> 里添加如下规则:</p>
<pre data-lang="conf" style="background-color:#2b303b;color:#c0c5ce;" class="language-conf "><code class="language-conf" data-lang="conf"><span>~/.config/picom/picom.conf
</span><span style="color:#65737e;"># Specify a list of conditions of windows that should have no shadow.
</span><span style="color:#65737e;">#
</span><span style="color:#65737e;"># examples:
</span><span style="color:#65737e;">#   shadow-exclude = &quot;n:e:Notification&quot;;
</span><span style="color:#65737e;">#
</span><span style="color:#65737e;"># shadow-exclude = []
</span><span style="color:#bf616a;">shadow-exclude </span><span>= [
</span><span>  </span><span style="color:#65737e;"># ...
</span><span>  </span><span style="color:#a3be8c;">&quot;name = &#39;WeChat&#39;&quot;</span><span>,
</span><span>  </span><span style="color:#a3be8c;">&quot;class_g = &#39;wechat.exe&#39;&quot;</span><span>,
</span><span>  </span><span style="color:#a3be8c;">&quot;class_g = &#39;Wine&#39;&quot;
</span><span>];
</span></code></pre>
<p>重启 picom 即可</p>
<h4 id="zi-ti-fa-xu">字体发虚</h4>
<p>打开 wine 设置</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span># /opt/apps/com.qq.weixin.deepin/files/run.sh winecfg
</span></code></pre>
<p>graphics 选项卡里调高DPI即可</p>
<h4 id="bu-fen-emoji-wei-fang-kuai">部分 Emoji 为方块</h4>
<p>尚未解决</p>


            </main>
            <footer>
                
<p class="taxonomies">


<a href="/tags/wechat">#wechat</a>



<a href="/categories/arch">+arch</a>




</p>

                
            </footer>
        </div>
    </body>
</html>
        
